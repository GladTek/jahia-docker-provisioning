# Install and start Personal API Tokens
- installBundle: "mvn:org.jahia.modules/personal-api-tokens/1.0.0"
  autoStart: true
- startBundle: "personal-api-tokens/1.0.0"

# Install and start all the modules needed by Digitall
- installOrUpgradeBundle: 'mvn:org.jahia.modules/press/3.0.0'
- startBundle: "press/3.0.0"
- installOrUpgradeBundle: 'mvn:org.jahia.modules/person/3.1.0'
- startBundle: "person/3.1.0"
- installOrUpgradeBundle: 'mvn:org.jahia.modules/news/3.1.0'
- startBundle: "news/3.1.0"
- installOrUpgradeBundle: 'mvn:org.jahia.modules/font-awesome/6.1.3'
- startBundle: "font-awesome/6.1.3"
- installOrUpgradeBundle: 'mvn:org.jahia.modules/calendar/3.1.0'
- startBundle: "calendar/3.1.0"
- installOrUpgradeBundle: 'mvn:org.jahia.modules/bootstrap3-core/4.1.0'
- startBundle: "bootstrap3-core/4.1.0"
- installOrUpgradeBundle: 'mvn:org.jahia.modules/bootstrap3-components/4.1.0'
- startBundle: 'bootstrap3-components/4.1.0'
- installOrUpgradeBundle: 'mvn:org.jahia.modules/location/3.0.0'
- startBundle: 'location/3.0.0'
- installOrUpgradeBundle: 'mvn:org.jahia.modules/topstories/3.0.0'
- startBundle: 'topstories/3.0.0'
- installOrUpgradeBundle: 'mvn:org.jahia.modules/rating/3.2.0'
- startBundle: 'rating/3.2.0'
- installOrUpgradeBundle: 'mvn:org.jahia.modules/event/3.0.0'
- startBundle: 'event/3.0.0'
- installOrUpgradeBundle: 'mvn:org.jahia.modules/bookmarks/3.1.0'
- startBundle: 'bookmarks/3.1.0'
- installOrUpgradeBundle: 'mvn:org.jahia.modules/dx-base-demo-core/2.2.0'
- startBundle: 'dx-base-demo-core/2.2.0'
- installOrUpgradeBundle: 'mvn:org.jahia.modules/dx-base-demo-templates/3.1.0'
- startBundle: 'dx-base-demo-templates/3.1.0'
- installOrUpgradeBundle: 'mvn:org.jahia.modules/dx-base-demo-components/2.1.0'
- startBundle: 'dx-base-demo-components/2.1.0'
- installOrUpgradeBundle: 'mvn:org.jahia.modules/digitall/2.0.0'
- startBundle: 'digitall/2.0.0'

# Create a token
- executeScript: "https://raw.githubusercontent.com/Jahia/provisioning-tutorials/main/01-personal-api-tokens/create-token.groovy"

# Import Digitall site
- import: "jar:mvn:org.jahia.modules/digitall/2.0.0/zip/import!/users.zip"
- importSite: "jar:mvn:org.jahia.modules/digitall/2.0.0/zip/import!/Digitall.zip"

# Augmented-Search dependencies are only available from Jahia store
# So we're adding a new repository to be able to resolve these dependencies
- addMavenRepository: 'https://store.jahia.com/nexus/content/repositories/jahia-public-app-store@id=JahiaStore'

# Install Augmented-Search
- installAndStartBundle: 'mvn:org.jahia.modules/database-connector/1.3.0'
- startBundle: 'database-connector/1.3.0'
- installAndStartBundle: 'mvn:org.jahia.modules/elasticsearch-connector-7/7.4.3'
- startBundle: 'elasticsearch-connector-7/7.4.3'
- installAndStartBundle: 'mvn:org.jahia.modules/augmented-search/3.1.0'
- startBundle: 'augmented-search/3.1.0'

# Configure database connector with a groovy script
- executeScript: "https://raw.githubusercontent.com/Jahia/provisioning-tutorials/main/03-augmented-search/db-connection.groovy"

# Configure Augmented Search and digitall
- executeScript: "https://raw.githubusercontent.com/Jahia/provisioning-tutorials/main/03-augmented-search/as-config.graphql"

# Install our Augmented-Search sample UI and enable it on Digitall
- installAndStartBundle: 'mvn:org.jahia.modules/augmented-search-ui/3.0.1'
- startBundle: 'augmented-search-ui/3.0.1'
- enable: "augmented-search-ui"
  site: "digitall"

# Trigger a full indexation
- executeScript: "https://raw.githubusercontent.com/Jahia/provisioning-tutorials/main/03-augmented-search/as-index.graphql"

# Add Augmented-Search UI module below the slider in Digitall home
- executeScript: "https://raw.githubusercontent.com/Jahia/provisioning-tutorials/main/03-augmented-search/add-search-ui.graphql"

# Publish Augmented-Search UI
- executeScript: "https://raw.githubusercontent.com/Jahia/provisioning-tutorials/main/03-augmented-search/publish-search-ui.graphql"
